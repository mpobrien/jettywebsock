<html>
    <head>
        <title>tetris</title>

        <script language="Javascript" src="/static/t.js"></script>
      <script type="text/javascript" src="/static/swfobject.js"></script>
      <script type="text/javascript" src="/static/FABridge.js"></script>
      <script type="text/javascript" src="/static/web_socket.js"></script>
        <script language="Javascript" src="/static/jquery-1.3.2.min.js"></script>
        <script type='text/javascript'>
            WebSocket.__swfLocation = "/static/WebSocketMain.swf";
            //WebSocket.__swfLocation = "static/WebSocketMain.swf";

            function getKeyCode(ev) {<!--{{{-->
                if (window.event) return window.event.keyCode;
                return ev.keyCode;
            } <!--}}}-->

		$(document).ready(
			function(){
                console.debug("opening");
				ws = new WebSocket("ws://localhost:8080/ws/");
				ws.onopen = function(){ alert("opened") };
				ws.onclose = function(){ alert("closed") };
				ws.onmessage = function(d){ alert(d.data) };
			}
		);

/*
            $(document).ready(
                function(){
                    canvas = $('#tetris')[0]
                    shape = new Shape();
                    tetrisBoard.setup( canvas );
                    tetrisBoard.draw();
                    tick = function(){
                        if( addmatrixIsLegal( tetrisBoard.board, shape.matrix, shape.x, shape.y+1 ) ){
                            shape.y += 1
                        }else{
                            shape.y = shape.drop( tetrisBoard.board );
                            tetrisBoard.draw(true, true)
                            shape = new Shape()
                        }
                        tetrisBoard.draw()
                    }
                    setInterval( tick, 1000 )
                    $(document).keydown(
                        function(e){
                            redraw = false;
                            if (window.event) keycode = window.event.keyCode;
                            else if (e) keycode = e.which;
                            //console.debug( keycode )
                            if( keycode == 38 ){
                                shape.rotate( tetrisBoard.board );
                                redraw = true;
                                e.preventDefault();
                            }else if( keycode == 37 ){ //left
                                if(shape.x > 0 || (shape.x + shape.sideroom(false)>0)){
                                    if( shape.canMove( tetrisBoard.board, -1, 0 ) ){
                                        shape.x -= 1;
                                        redraw = true;
                                    }
                                }
                                e.preventDefault();
                            }else if( keycode == 39 ){ // right
                                if( shape.x + shape.matsize < numCols ||
                                    ( shape.x + shape.matsize - shape.sideroom(true) <numCols ) ){
                                    if( shape.canMove( tetrisBoard.board, 1, 0 ) ){
                                        shape.x += 1;
                                        redraw = true;
                                    }
                                }
                                e.preventDefault();
                            }
                            else if( keycode == 13 ){
                                shape.y = shape.drop( tetrisBoard.board );
                                tetrisBoard.draw(true, true)
                                shape = new Shape()
                                tetrisBoard.draw(false)
                                e.preventDefault();
                            }else if( keycode == 40 ){
                                if( shape.canMove( tetrisBoard.board, 0, 1 ) ){
                                    shape.y += 1;
                                    redraw = true;
                                }
                                e.preventDefault();
                            }
                            if( redraw ) tetrisBoard.draw()

                        }
                    )  
                } 
            );
			*/
        </script>
    </head>
    <body>
        <div style="width:100%">
            <div id="main" style="width:100%; margin-left:auto; margin-right: auto; text-align:center">
                <canvas id="tetris" width="200" height="400"></canvas>
                <p>
                    &rarr; &darr; and &larr; to move<br/>
                    &uarr; to rotate<br/>
                    <b>enter</b> to drop<br/><br/>
                    source at <a href="http://github.com/mpobrien/jettywebsock">github/mpobrien</a><br/><br/>
		   <br/> might not work in all browsers <br/> deal with it<br/>
                </p>
            </div>
        </div>
	<script type="text/javascript">
	var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
	document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
	</script>
	<script type="text/javascript">
	try {
	var pageTracker = _gat._getTracker("UA-12798677-1");
	pageTracker._trackPageview();
	} catch(err) {}</script>
    </body>
</html>
        
